<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <style>
    body {
      background: #f8f4fb;
      font-family: 'Segoe UI', sans-serif;
      padding: 40px;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #7e57c2;
      margin-bottom: 30px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(126, 87, 194, 0.1);
    }
    th, td {
      padding: 14px;
      border: 1px solid #e0d7ec;
      text-align: center;
    }
    th {
      background: #e1bee7;
      color: #4a148c;
    }
    select, button {
      padding: 5px 10px;
      border-radius: 5px;
      border: 1px solid #c7b1d6;
      background: #f3e5f5;
      color: #4a148c;
      cursor: pointer;
    }
    select {
      margin-right: 5px;
    }
    .summary {
      background: #e1bee7;
      color: #4a148c;
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h1>
  <div class="summary" id="summary"></div>
  <table id="repairTable">
    <thead>
      <tr>
        <th>‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°</th>
        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°</th>
        <th>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°</th>
        <th>‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏∏‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</th>
        <th>‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°</th>
        <th>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á</th>
        <th>‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö</th>
        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    function loadData() {
      google.script.run.withSuccessHandler(drawTable).getRepairData();
    }

    function drawTable(data) {
      const tbody = document.querySelector('#repairTable tbody');
      tbody.innerHTML = '';
      let summary = {
        '‡∏£‡∏≠‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°': 0,
        '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß': 0,
        '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥': 0,
        '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏û‡∏±‡∏™‡∏î‡∏∏': 0,
        '‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢': 0
      };

      for (let i = 1; i < data.length; i++) {
        const row = data[i];
        const tr = document.createElement('tr');

        for (let j = 1; j < row.length - 1; j++) { // ‡πÑ‡∏°‡πà‡πÄ‡∏≠‡∏≤‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤, ‡πÄ‡∏≠‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡∏π‡∏õ
          const td = document.createElement('td');
          if (j === 7) {
            td.innerHTML = `<a href="${row[j]}" target="_blank">‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå</a>`;
          } else {
            td.textContent = row[j];
          }
          tr.appendChild(td);
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        const tdStatus = document.createElement('td');
        tdStatus.textContent = row[8];
        tr.appendChild(tdStatus);

        summary[row[8]] = (summary[row[8]] || 0) + 1;

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        const tdAction = document.createElement('td');
        const select = document.createElement('select');
        ['‡∏£‡∏≠‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°', '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß', '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', '‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏û‡∏±‡∏™‡∏î‡∏∏', '‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'].forEach(s => {
          const option = document.createElement('option');
          option.value = s;
          option.textContent = s;
          if (s === row[8]) option.selected = true;
          select.appendChild(option);
        });

        const btn = document.createElement('button');
        btn.textContent = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï';
        btn.onclick = () => {
          google.script.run.withSuccessHandler(loadData)
            .updateStatus(i, select.value);
        };

        tdAction.appendChild(select);
        tdAction.appendChild(btn);
        tr.appendChild(tdAction);

        tbody.appendChild(tr);
      }

      document.getElementById('summary').innerHTML = `
        üì¶ ‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß: ${summary['‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß']} |
        üïí ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥: ${summary['‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥']} |
        üìÇ ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏û‡∏±‡∏™‡∏î‡∏∏: ${summary['‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏û‡∏±‡∏™‡∏î‡∏∏']} |
        ‚úÖ ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢: ${summary['‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢']}
      `;
    }

    window.onload = loadData;
  </script>
</body>
</html>
